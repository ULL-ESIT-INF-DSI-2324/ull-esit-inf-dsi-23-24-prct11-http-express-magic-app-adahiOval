<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>practica10</title><meta name="description" content="Documentation for practica10"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">practica10</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h2>practica10</h2></div><div class="tsd-panel tsd-typography"><p><a href="https://github.com/ULL-ESIT-INF-DSI-2324/ull-esit-inf-dsi-23-24-prct10-fs-proc-sockets-magic-app-adahiOval/actions/workflows/node.js.yml"><img src="https://github.com/ULL-ESIT-INF-DSI-2324/ull-esit-inf-dsi-23-24-prct10-fs-proc-sockets-magic-app-adahiOval/actions/workflows/node.js.yml/badge.svg?branch=main" alt="Tests"></a></p>
<p><a href="https://coveralls.io/github/ULL-ESIT-INF-DSI-2324_ull-esit-inf-dsi-23-24-prct10-fs-proc-sockets-magic-app-adahiOval?branch=main"><img src="https://coveralls.io/repos/github/ULL-ESIT-INF-DSI-2324/ull-esit-inf-dsi-23-24-prct09-filesystem-magic-app-adahi-oval/badge.svg?branch=main" alt="Coverage Status"></a></p>
<p><a href="https://sonarcloud.io/summary/new_code?id=ULL-ESIT-INF-DSI-2324_ull-esit-inf-dsi-23-24-prct10-fs-proc-sockets-magic-app-adahiOval"><img src="https://sonarcloud.io/api/project_badges/measure?project=ULL-ESIT-INF-DSI-2324_ull-esit-inf-dsi-23-24-prct10-fs-proc-sockets-magic-app-adahiOval&metric=alert_status" alt="Quality Gate Status"></a></p>
<a id="md:introducción" class="tsd-anchor"></a><h2><a href="#md:introducción">Introducción</a></h2><p>En esta práctica se presenta 1 ejercicio para familiarizarnos con el modulo yargs y el modulo chalk, así como con los principios SOLID y los sockets en node con el patrón request-response y la API asincrona de Node y el patron callback y callback chaining. Para ello se han desarrollado este ejercicio en la carpeta <code>src</code> y sus correspondientes pruebas en la carpeta <code>test</code>. </p>
<p>Para la instalación de las dependencias necesarias para hacer funcionar el código solo es necesario el comando:</p>
<pre><code class="language-bash"><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">install</span>
</code><button>Copy</button></pre>
<a id="md:objetivos" class="tsd-anchor"></a><h2><a href="#md:objetivos">Objetivos</a></h2><p>Los objetivos de esta práctica son la familiarización con los modulos yargs y chalk, así como los principios SOLID de 
programación orientada a objetos y también la implementación de coveralls en nuestro código, el patrón request-response 
y los sockets y la programación asincrona con la api asincrona de Node. </p>
<a id="md:clases" class="tsd-anchor"></a><h2><a href="#md:clases">Clases</a></h2><p>Las clases desarrolladas para esta práctica son las siguientes:</p>
<ul>
<li>Card: Clase base de los distintos tipos de cartas, con sus correspondientes atributos</li>
<li>CardCollection: Coleccion de cartas.</li>
<li>CardCollectionReader: Lector de Coleccion de cartas a partir de un directorio de un usuario</li>
<li>CardCollectionPrinter: Printer de una coleccion de cartas dada</li>
<li>CardCollectionWriter: Escritor de la coleccion de cartas en el directorio del usuario de la misma</li>
<li>CardReader: Lector de carta individual a partir de un objeto JSON</li>
<li>EventEmitterServer: Clase cuya funcion principal es un server que tenga manera de asegurarse de que los mensajes 
 llegan completos desde el socket al server.</li>
</ul>
<a id="md:card" class="tsd-anchor"></a><h3><a href="#md:card">Card</a></h3><p>Esta es la clase base de los distintos tipos de cartas. Es una clase abstracta cuyo constructor tiene los atributos mínimos compartidos por todas las cartas. De ella se crea una clase diferente para cada tipo de carta:</p>
<ul>
<li>Tierra</li>
<li>Encantamiento</li>
<li>Conjuro</li>
<li>Instantaneo</li>
<li>Artefacto</li>
<li>Criatura: Con el atributo adicional <code>stats</code></li>
<li>Planeswalker: Con el atributo adicional <code>loyalty</code></li>
</ul>
<p>También se define un método abstracto <code>print()</code> que cada una de las clases hijas implementa propiamente.</p>
<a id="md:cardcollection" class="tsd-anchor"></a><h3><a href="#md:cardcollection">CardCollection</a></h3><p>Esta es la clase que representa una colección de cartas de un usuario dado. Su constructor recibe un array de objetos tipo <code>Card</code> y un string con el nombre de usuario. Dentro de esta clase se encuentran los siguientes métodos:</p>
<ul>
<li><code>addCard</code>: Este es el método para añadir una carta a la colección, se le pasa una carta por parámetro y la añade al array de cartas de la colección</li>
<li><code>updateCard</code>: Este método modifica una carta existente, se le pasa una carta y elimina la carta existente con el mismo ID y añade la nueva carta dada por parametro.</li>
<li><code>deleteCard</code>: Este método elimina una carta de la colección, se le pasa un ID por parámetro que comprueba si existe primero y luego filtra la colección para que devuelva un nuevo array con los IDs que no coinciden.</li>
<li><code>showCard</code>: Este método muestra la información de una sola carta por consola, se le pasa un ID que busca en la colección e invoca el método print de la carta concreta.</li>
<li><code>listCollection</code>: Este método lista todas las cartas de la colección, para ello crea un objeto <code>CardCollectionPrinter</code> que toma la propia coleccion, y luego invoca a su método print que a su vez invoca el metodo print de todas las cartas de la colección.</li>
</ul>
<a id="md:cardcollectionreader" class="tsd-anchor"></a><h3><a href="#md:cardcollectionreader">CardCollectionReader</a></h3><p>Esta clase se encarga de leer las cartas del directorio de un usuario dado. Para ello, se le pasa el nombre de usuario en el constructor, que se encarga de crear la ruta relativa al directorio del usuario utilizando el módulo <code>path</code> de la siguiente manera:</p>
<pre><code class="language-typescript"><span class="hl-0">constructor</span><span class="hl-1">(</span><span class="hl-3">private</span><span class="hl-1"> </span><span class="hl-3">user</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1">, </span><span class="hl-3">callback</span><span class="hl-1">: (</span><span class="hl-3">err</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1"> | </span><span class="hl-4">undefined</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-5">void</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">__dirname</span><span class="hl-1"> = </span><span class="hl-3">path</span><span class="hl-1">.</span><span class="hl-0">dirname</span><span class="hl-1">(</span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">URL</span><span class="hl-1">(</span><span class="hl-7">import</span><span class="hl-1">.</span><span class="hl-3">meta</span><span class="hl-1">.</span><span class="hl-3">url</span><span class="hl-1">).</span><span class="hl-3">pathname</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">fatherdir</span><span class="hl-1"> = </span><span class="hl-3">path</span><span class="hl-1">.</span><span class="hl-0">resolve</span><span class="hl-1">(</span><span class="hl-3">__dirname</span><span class="hl-1">, </span><span class="hl-2">&#39;..&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">sourcedir</span><span class="hl-1"> = </span><span class="hl-3">path</span><span class="hl-1">.</span><span class="hl-0">resolve</span><span class="hl-1">(</span><span class="hl-3">fatherdir</span><span class="hl-1">, </span><span class="hl-2">&#39;..&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-3">route</span><span class="hl-1"> = </span><span class="hl-3">path</span><span class="hl-1">.</span><span class="hl-0">join</span><span class="hl-1">(</span><span class="hl-3">sourcedir</span><span class="hl-1">, </span><span class="hl-2">`src/database/users/</span><span class="hl-5">${</span><span class="hl-5">this</span><span class="hl-8">.</span><span class="hl-3">user</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-0">readDir</span><span class="hl-1">((</span><span class="hl-3">err</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-7">if</span><span class="hl-1">(</span><span class="hl-3">err</span><span class="hl-1">){</span><br/><span class="hl-1">        </span><span class="hl-0">callback</span><span class="hl-1">(</span><span class="hl-3">err</span><span class="hl-1">);</span><br/><span class="hl-1">      } </span><span class="hl-7">else</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">callback</span><span class="hl-1">(</span><span class="hl-5">undefined</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  }</span>
</code><button>Copy</button></pre>
<p>Luego hace uso de un método <code>readDir</code> que lee todo el directorio con la ruta anterior, probando su existencia primero, y para cada archivo encontrado, llama al método <code>JSON.parse</code> y crea un objeto <code>CardReader</code> con ese resultado, luego hace uso del método <code>returnCard</code> del objeto <code>CardReader</code> que devuelve una Carta ya creada y la añade al array de la colección:</p>
<pre><code class="language-typescript"><span class="hl-1">  </span><span class="hl-0">readDir</span><span class="hl-1">(</span><span class="hl-3">callback</span><span class="hl-1">: (</span><span class="hl-3">err</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1"> | </span><span class="hl-4">undefined</span><span class="hl-1">, </span><span class="hl-3">success</span><span class="hl-1">: </span><span class="hl-4">number</span><span class="hl-1"> | </span><span class="hl-4">undefined</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-5">void</span><span class="hl-1">): </span><span class="hl-5">void</span><span class="hl-1"> {</span><br/><br/><span class="hl-1">    </span><span class="hl-3">fs</span><span class="hl-1">.</span><span class="hl-0">readdir</span><span class="hl-1">(</span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-3">route</span><span class="hl-1">, (</span><span class="hl-3">err</span><span class="hl-1">, </span><span class="hl-3">cards</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-7">if</span><span class="hl-1"> (</span><span class="hl-3">err</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">callback</span><span class="hl-1">(</span><span class="hl-3">err</span><span class="hl-1">.</span><span class="hl-3">message</span><span class="hl-1">, </span><span class="hl-5">undefined</span><span class="hl-1">);</span><br/><span class="hl-1">      } </span><span class="hl-7">else</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-7">if</span><span class="hl-1">(</span><span class="hl-3">cards</span><span class="hl-1">.</span><span class="hl-3">length</span><span class="hl-1"> == </span><span class="hl-9">0</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-0">callback</span><span class="hl-1">(</span><span class="hl-5">undefined</span><span class="hl-1">, </span><span class="hl-9">0</span><span class="hl-1">);</span><br/><span class="hl-1">        } </span><span class="hl-7">else</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-5">let</span><span class="hl-1"> </span><span class="hl-3">cardCount</span><span class="hl-1"> = </span><span class="hl-9">0</span><span class="hl-1">;</span><br/><span class="hl-1">          </span><span class="hl-3">cards</span><span class="hl-1">.</span><span class="hl-0">forEach</span><span class="hl-1">((</span><span class="hl-3">card</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-3">fs</span><span class="hl-1">.</span><span class="hl-0">readFile</span><span class="hl-1">(</span><span class="hl-2">`</span><span class="hl-5">${</span><span class="hl-5">this</span><span class="hl-8">.</span><span class="hl-3">route</span><span class="hl-5">}</span><span class="hl-2">/</span><span class="hl-5">${</span><span class="hl-3">card</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">, </span><span class="hl-2">&#39;utf-8&#39;</span><span class="hl-1">, (</span><span class="hl-3">err</span><span class="hl-1">, </span><span class="hl-3">content</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">              </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">data</span><span class="hl-1">: </span><span class="hl-4">CardShape</span><span class="hl-1"> = </span><span class="hl-6">JSON</span><span class="hl-1">.</span><span class="hl-0">parse</span><span class="hl-1">(</span><span class="hl-3">content</span><span class="hl-1">);</span><br/><span class="hl-1">              </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">reader</span><span class="hl-1">: </span><span class="hl-4">CardReader</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">CardReader</span><span class="hl-1">(</span><span class="hl-3">data</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><br/><span class="hl-1">              </span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-3">collection</span><span class="hl-1">.</span><span class="hl-0">push</span><span class="hl-1">(</span><span class="hl-3">reader</span><span class="hl-1">.</span><span class="hl-0">returnCard</span><span class="hl-1">());</span><br/><span class="hl-1">              </span><span class="hl-3">cardCount</span><span class="hl-1">++;</span><br/><span class="hl-1">              </span><span class="hl-7">if</span><span class="hl-1">(</span><span class="hl-3">cardCount</span><span class="hl-1"> === </span><span class="hl-3">cards</span><span class="hl-1">.</span><span class="hl-3">length</span><span class="hl-1">) {</span><br/><span class="hl-1">                </span><span class="hl-0">callback</span><span class="hl-1">(</span><span class="hl-5">undefined</span><span class="hl-1">, </span><span class="hl-9">0</span><span class="hl-1">)</span><br/><span class="hl-1">              }</span><br/><span class="hl-1">            });</span><br/><span class="hl-1">          });</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      } </span><br/><span class="hl-1">    });</span><br/><br/><span class="hl-1">  }</span>
</code><button>Copy</button></pre>
<p>Al ser todo código asíncrono y ser este el primer paso de cualquier ejecución del programa, ésta es la clase &quot;principal&quot; de la que se anida el resto del código en cada acción. Por ende, todo el código principal de la aplicación utiliza el patrón callback chaining para funcionar y hacer uso de la API asíncrona de Node.</p>
<a id="md:cardcollectionwriter" class="tsd-anchor"></a><h3><a href="#md:cardcollectionwriter">CardCollectionWriter</a></h3><p>Esta es la clase encargada de escribir los resultados de las operaciones sobre la colección en el directorio del usuario inicial. Para ello, hace uso del método <code>write()</code> que primero borra todos los archivos del directorio del usuario, para luego escribir las cartas de la colección cada una en un archivo <code>JSON</code> separado. Se ha optado por esta forma ya que simplifica mucho el manejo del sistema de archivos del ordenador.</p>
<pre><code class="language-typescript"><span class="hl-0">write</span><span class="hl-1">(): </span><span class="hl-5">void</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-10">// Limpia el directorio antes de escribir la colección</span><br/><span class="hl-1">    </span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-0">clean</span><span class="hl-1">((</span><span class="hl-3">err</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-7">if</span><span class="hl-1">(</span><span class="hl-3">err</span><span class="hl-1">){</span><br/><span class="hl-1">        </span><span class="hl-7">throw</span><span class="hl-1"> </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-3">err</span><span class="hl-1">);</span><br/><span class="hl-1">      } </span><span class="hl-7">else</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-10">// Escribe cada carta en un archivo JSON en el directorio</span><br/><span class="hl-1">        </span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-3">collection</span><span class="hl-1">.</span><span class="hl-3">collection</span><span class="hl-1">.</span><span class="hl-0">forEach</span><span class="hl-1">((</span><span class="hl-3">card</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">cardPath</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1"> = </span><span class="hl-3">path</span><span class="hl-1">.</span><span class="hl-0">join</span><span class="hl-1">(</span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-3">route</span><span class="hl-1">, </span><span class="hl-2">`</span><span class="hl-5">${</span><span class="hl-3">card</span><span class="hl-8">.</span><span class="hl-3">name</span><span class="hl-5">}</span><span class="hl-2">.json`</span><span class="hl-1">);</span><br/><span class="hl-1">          </span><span class="hl-3">fs</span><span class="hl-1">.</span><span class="hl-0">writeFile</span><span class="hl-1">(</span><span class="hl-3">cardPath</span><span class="hl-1">, </span><span class="hl-6">JSON</span><span class="hl-1">.</span><span class="hl-0">stringify</span><span class="hl-1">(</span><span class="hl-3">card</span><span class="hl-1">), (</span><span class="hl-3">err</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-7">if</span><span class="hl-1"> (</span><span class="hl-3">err</span><span class="hl-1">) {</span><br/><span class="hl-1">              </span><span class="hl-7">throw</span><span class="hl-1"> </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-3">err</span><span class="hl-1">.</span><span class="hl-3">message</span><span class="hl-1">);</span><br/><span class="hl-1">            }</span><br/><span class="hl-1">          });</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">      } </span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  }</span>
</code><button>Copy</button></pre>
<p>Como se puede observar, se utiliza un método &#39;clean&#39; al que se le pasa un manejador por parámetro, esto es porque necesitamos esperar a borrar los archivos mediante la API asincrona de Node y para asegurarnos de ello debemos usar el patron callback nuevamente. El método <code>clean</code> luce de la siguiente manera:</p>
<pre><code class="language-typescript"><span class="hl-1">  </span><span class="hl-0">clean</span><span class="hl-1">(</span><span class="hl-3">callback</span><span class="hl-1">: (</span><span class="hl-3">err</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1"> | </span><span class="hl-4">undefined</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-5">void</span><span class="hl-1">): </span><span class="hl-5">void</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">fs</span><span class="hl-1">.</span><span class="hl-0">readdir</span><span class="hl-1">(</span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-3">route</span><span class="hl-1">, (</span><span class="hl-3">err</span><span class="hl-1">, </span><span class="hl-3">files</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-7">if</span><span class="hl-1"> (</span><span class="hl-3">err</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-7">throw</span><span class="hl-1"> </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-3">err</span><span class="hl-1">.</span><span class="hl-3">message</span><span class="hl-1">);</span><br/><span class="hl-1">      } </span><span class="hl-7">else</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-7">if</span><span class="hl-1">(</span><span class="hl-3">files</span><span class="hl-1">.</span><span class="hl-3">length</span><span class="hl-1"> == </span><span class="hl-9">0</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-0">callback</span><span class="hl-1">(</span><span class="hl-5">undefined</span><span class="hl-1">);</span><br/><span class="hl-1">        } </span><span class="hl-7">else</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-5">let</span><span class="hl-1"> </span><span class="hl-3">fileCount</span><span class="hl-1"> = </span><span class="hl-9">0</span><span class="hl-1">;</span><br/><span class="hl-1">          </span><span class="hl-3">files</span><span class="hl-1">.</span><span class="hl-0">forEach</span><span class="hl-1">((</span><span class="hl-3">file</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">filePath</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1"> = </span><span class="hl-3">path</span><span class="hl-1">.</span><span class="hl-0">join</span><span class="hl-1">(</span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-3">route</span><span class="hl-1">, </span><span class="hl-3">file</span><span class="hl-1">);</span><br/><span class="hl-1">            </span><span class="hl-10">// Elimina cada archivo en el directorio</span><br/><span class="hl-1">            </span><span class="hl-3">fs</span><span class="hl-1">.</span><span class="hl-0">unlink</span><span class="hl-1">(</span><span class="hl-3">filePath</span><span class="hl-1">, (</span><span class="hl-3">err</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">              </span><span class="hl-7">if</span><span class="hl-1"> (</span><span class="hl-3">err</span><span class="hl-1">) {</span><br/><span class="hl-1">                </span><span class="hl-7">throw</span><span class="hl-1"> </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-3">err</span><span class="hl-1">.</span><span class="hl-3">message</span><span class="hl-1">);</span><br/><span class="hl-1">              } </span><span class="hl-7">else</span><span class="hl-1"> {</span><br/><span class="hl-1">                </span><span class="hl-3">fileCount</span><span class="hl-1">++;</span><br/><span class="hl-1">                </span><span class="hl-10">// Si todos los archivos han sido eliminados, llama al callback sin errores</span><br/><span class="hl-1">                </span><span class="hl-7">if</span><span class="hl-1">(</span><span class="hl-3">fileCount</span><span class="hl-1"> === </span><span class="hl-3">files</span><span class="hl-1">.</span><span class="hl-3">length</span><span class="hl-1">) {</span><br/><span class="hl-1">                  </span><span class="hl-0">callback</span><span class="hl-1">(</span><span class="hl-5">undefined</span><span class="hl-1">);</span><br/><span class="hl-1">                }</span><br/><span class="hl-1">              }</span><br/><span class="hl-1">            });</span><br/><span class="hl-1">          });</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  }</span>
</code><button>Copy</button></pre>
<a id="md:magic-clientts" class="tsd-anchor"></a><h2><a href="#md:magic-clientts">magic-client.ts</a></h2><p>Este es el archivo principal del programa desde el lado del cliente, éste se encarga de utilizar yargs para parsear los argumentos invocados por linea de comandos según la acción que queramos pedirle realizar al servidor. Éstas son:</p>
<ul>
<li>add(): Añade una carta</li>
<li>update(): Actualiza una carta</li>
<li>remove(): Elimina una carta</li>
<li>list(): Lista las cartas de un usuario</li>
<li>read(): Lee una carta de un usuario</li>
</ul>
<p>Para cada una de estas acciones, se crea un socket desde el lado del cliente para conectarse por el puerto <code>60300</code> al servidor, y se le manda un archivo JSON que siempre consta de un atributo <code>requestType</code> cuyo valor le indica al servidor que tipo de petición se le está realizando, por ejemplo, si invocamos el cliente con el comando <strong>add</strong> el server recibirá un JSON con <code>&quot;requestType&quot;: &quot;add&quot;</code> así como un parámetro <code>card</code> con toda la información de la carta que queremos añadir. Pasa lo mismo con los otros comandos, siempre se le pasará al servidor un JSON con <code>requestType</code> y el resto de la información necesaria para esa acción. Así mismo, el cliente también recibe la respuesta del servidor, esto es, otro JSON con un parámetro <code>success</code> cuyo valor es <strong>true</strong> o <strong>false</strong> , indicando si la petición ha sido satisfactoria o no. El cliente, interpreta la respuesta del servidor, viendo que si <code>success</code> es true, se imprime por consola el mensaje llegado del servidor en verde y subrayado haciendo uso de <code>chalk</code>. En caso contrario, se escribe el mensaje recibido del server en rojo.</p>
<p>En caso de <code>list</code> y <code>read</code>, la respuesta del servidor no conlleva un mensaje sino una lista de cartas del usuario dado, éstas se imprimen por la consola del cliente haciendo uso de chalk para el color de la carta.</p>
<a id="md:magic-serverts" class="tsd-anchor"></a><h2><a href="#md:magic-serverts">magic-server.ts</a></h2><p>Este es el programa principal del servidor, el server es un objeto tipo <code>EventEmitterServer</code>, de ésta manera se asegura que el mensaje llegado del cliente está completo sin necesidad de usar <code>.end()</code>. Esto se hace analizando el mensaje llegado desde el socket y cuando se encuentre <strong>\n</strong>, significa que el mensaje ha terminado, ya que este es el formato que se ha implementado para esta practica. Una vez encuentra el caracter \n, emite un evento de tipo &#39;message&#39; para señalizar que se ha finalizado la recepción del mensaje. Y una vez se recibe el mensaje se procede a procesar la petición.</p>
<p>Primero se analiza el parámetro <code>requestType</code> del mensaje, para ver por donde se tiene que ejecutar el código, si es una petición tipo <code>add</code> por ejemplo, se lee la colección del usuario dado, se crea una colección con esas cartas y se crea la nueva carta con el parámetro <code>card</code> de la petición. Luego esta carta se añade a la colección creada y se escribe en el sistema de archivos de forma asíncrona. Al igual que la lectura, que es también asíncrona. Una vez se termina la operación, se le envía al cliente la respuesta con el parámetro <code>success</code> y el parámetro <code>message</code> (o la lista de carta si es una petición <strong>list</strong> o <strong>read</strong>), y se termina la conexión con el cliente mientras el servidor sigue ejecutándose.</p>
<a id="md:ejercicio-pe" class="tsd-anchor"></a><h2><a href="#md:ejercicio-pe">Ejercicio PE</a></h2><p>En el ejercicio PE de esta semana, se ha trabajado con los sockets de Node para hacer una aplicación cliente servidor usando el patrón request-response de manera que al cliente se le proporcionaba un <code>filename</code> y se le enviaba al servidor, el server con ese filename tenía que spawnear los procesos <code>wc</code> y <code>cat</code> para contar cuantos caracteres tenía ese archivo y devolverlos al cliente y terminar su conexión. Para ello se hizo uso de las <code>pipes</code>. </p>
<a id="md:conclusiones" class="tsd-anchor"></a><h2><a href="#md:conclusiones">Conclusiones</a></h2><p>En esta práctica se ha profundizado en el desarrollo de código según los principios SOLID, así como familiarizarse con el uso de módulos <code>chalk</code> y <code>yargs</code>, así como de la API Asíncrona de Node.js para el manejo del sistema de archivos, los sockets de Node, el patrón callback y callback chaining y el patrón request-response. También del cubrimiento del código mediante Coveralls, la documentación del mismo mediante Typedoc y la gestión de calidad mediante SonarCloud.</p>
<a id="md:bibliografía" class="tsd-anchor"></a><h2><a href="#md:bibliografía">Bibliografía</a></h2><ul>
<li><a href="https://ull-esit-inf-dsi-2324.github.io/typescript-theory/">Apuntes de la asignatura</a><ul>
<li><a href="https://ull-esit-inf-dsi-2324.github.io/typescript-theory/typescript-solid.html">Principios SOLID</a></li>
</ul>
</li>
<li><a href="https://ull-esit-inf-dsi-2324.github.io/nodejs-theory/">Apuntes de la asignatura sobre Node.js</a><ul>
<li><a href="https://ull-esit-inf-dsi-2324.github.io/nodejs-theory/nodejs-sockets.html">Sockets</a></li>
<li><a href="https://ull-esit-inf-dsi-2324.github.io/nodejs-theory/nodejs-http-callback-pattern.html">Callback y CallbackChaining</a></li>
</ul>
</li>
</ul>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-index-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><h4 class="uppercase">Member Visibility</h4><form><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-private" name="private"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Private</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div><div class="tsd-theme-toggle"><h4 class="uppercase">Theme</h4><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-index-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#md:introducción"><span>Introducción</span></a><a href="#md:objetivos"><span>Objetivos</span></a><a href="#md:clases"><span>Clases</span></a><ul><li><a href="#md:card"><span>Card</span></a></li><li><a href="#md:cardcollection"><span>Card<wbr/>Collection</span></a></li><li><a href="#md:cardcollectionreader"><span>Card<wbr/>Collection<wbr/>Reader</span></a></li><li><a href="#md:cardcollectionwriter"><span>Card<wbr/>Collection<wbr/>Writer</span></a></li></ul><a href="#md:magic-clientts"><span>magic-<wbr/>client.ts</span></a><a href="#md:magic-serverts"><span>magic-<wbr/>server.ts</span></a><a href="#md:ejercicio-pe"><span>Ejercicio PE</span></a><a href="#md:conclusiones"><span>Conclusiones</span></a><a href="#md:bibliografía"><span>Bibliografía</span></a></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="index.html" class="current"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="assets/icons.svg#icon-1"></use></svg><span>practica10</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base="."><li>Loading...</li></ul></nav></div></div></div><div class="tsd-generator"><p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div><div class="overlay"></div></body></html>